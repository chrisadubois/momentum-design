"use strict";(()=>{var m=(n,t,e)=>new Promise((s,i)=>{var g=a=>{try{r(e.next(a))}catch(c){i(c)}},p=a=>{try{r(e.throw(a))}catch(c){i(c)}},r=a=>a.done?s(a.value):Promise.resolve(a.value).then(g,p);r((e=e.apply(n,t)).next())});var f={GET_SETTINGS:"storage_get_settings",SET_SETTINGS:"storage_set_settings",EXPORT:"export",PR_CREATED:"pr_created"};var y={VALID_CHILD_TYPES:["PAGE"]},I=["COMPONENT"],P={COMPONENT_NAME:"COMPONENT_NAME",PARENT_NAME:"PARENT_NAME",SET_OR_COMPONENT_NAME:"SET_OR_COMPONENT_NAME",SF_ALTERNATIVE:"SF_ALTERNATIVE",RTL:"RTL",WEIGHT:"WEIGHT",COLOR:"COLOR"},M={WEIGHT:"weight",COLOR:"color",RTL:"right to left",SF_ALTERNATIVE:"sf alternative"},o={DOCUMENT:y,SEARCH_CRITERIA:I,REPLACE_TERMS:P,FIGMA_VARIANTS:M};var A=n=>n?Object.keys(n).reduce((t,e)=>{let s=e.toLowerCase(),i=n[e].toLowerCase();return t[s]=i,t},{}):{};var E=class{constructor(t,e,s){this.node=t,this.destination=e,this.config=s,this.variants=A(this.node.variantProperties)}get replacementMap(){var g,p,r,a,c,S;let t=((g=this.node.parent)==null?void 0:g.type)==="COMPONENT_SET"?this.node.parent.name:this.node.name,e=((p=this.variants)==null?void 0:p[o.FIGMA_VARIANTS.RTL])==="true"?"rtl":void 0,s=((r=this.variants)==null?void 0:r[o.FIGMA_VARIANTS.SF_ALTERNATIVE])==="true"?"sf":void 0;return{[o.REPLACE_TERMS.COMPONENT_NAME]:this.node.name,[o.REPLACE_TERMS.PARENT_NAME]:(a=this.node.parent)==null?void 0:a.name,[o.REPLACE_TERMS.SET_OR_COMPONENT_NAME]:t,[o.REPLACE_TERMS.WEIGHT]:(c=this.variants)==null?void 0:c[o.FIGMA_VARIANTS.WEIGHT],[o.REPLACE_TERMS.COLOR]:(S=this.variants)==null?void 0:S[o.FIGMA_VARIANTS.COLOR],[o.REPLACE_TERMS.RTL]:e,[o.REPLACE_TERMS.SF_ALTERNATIVE]:s}}get assetName(){let t="",{fileName:e}=this.config,s=e.parts.reduce((g,p)=>{let r=this.replacementMap[p];return r&&g.push(r),g},[]);return t+=s.join(e.separator),e.suffix.parts.forEach(g=>{var r;let p=(r=this.replacementMap)==null?void 0:r[g];p&&(t+=e.suffix.separator,t+=p)}),t+=".",t+=this.config.exportSettings.format.toLowerCase(),t}get asset(){return new Promise((t,e)=>{this.node.exportAsync(this.config.exportSettings).then(s=>{t({path:`${this.destination?`${this.destination}/`:""}${this.assetName}`,data:String.fromCharCode.apply(null,s)})}).catch(s=>{figma.notify(s,{error:!0}),e(s)})})}},h=E;var u=class{constructor(t,e,s){this.node=t,this.destination=e,this.config=s}get assets(){return Promise.all(this.components.map(t=>t.asset))}excludeComponents(t){return t.filter(e=>{var s;return((s=A(e.variantProperties))==null?void 0:s[this.config.exclude.byVariant])!=="true"})}get components(){let t=this.node.findAllWithCriteria({types:o.SEARCH_CRITERIA});return this.excludeComponents(t).map(s=>new h(s,this.destination,this.config))}},N=u;var d=class{constructor(t,e){this.node=t,this.config=e}getDestination(t,e){let s=e.find(i=>t.toLowerCase().includes(i.page.toLowerCase()));return s==null?void 0:s.folder}get pages(){let t=[];if("children"in this.node){for(let e of this.node.children)if(o.DOCUMENT.VALID_CHILD_TYPES.includes(e.type)){let s=this.getDestination(e.name,this.config.mapPagesToFolder);(s||s==="")&&t.push(new N(e,s,this.config))}}return t}createChunks(t){let s=[];for(let i=0;i<t.length;i+=500)s.push(t.slice(i,i+500));return s}getAssetChunksFromPages(){return m(this,null,function*(){if(!this.pages.length)return[[]];let t=[];return yield Promise.all(this.pages.map(e=>e.assets.then(s=>{t.push(...s)}))),this.createChunks(t)})}},C=d;var L={mapPagesToFolder:[{page:"\u2705",folder:"core"},{page:"Colored Icons",folder:"colored"},{page:"Brand Icons",folder:"brand"}],fileName:{parts:["SET_OR_COMPONENT_NAME","SF_ALTERNATIVE","RTL"],separator:"-",suffix:{parts:["WEIGHT","COLOR"],separator:"_"}},exclude:{byVariant:"sf alternative"},exportSettings:{format:"SVG",contentsOnly:!0,useAbsoluteBounds:!1}},w={git:{githubPersonalToken:"<YourClassicPersonalAccessTokenHere>",githubOwner:"momentum-design",gitRepo:"momentum-design",gitBranch:`automation-${new Date().toISOString().replace(/\.|:/g,"-")}`,prTitle:`Asset Automation ${new Date().toISOString()}`,prCommitMsg:`feat(assets): Asset Automation ${new Date().toISOString()}`,prMessage:`feat(assets): Asset Automation ${new Date().toISOString()}`,gitRepoFilePath:"packages/@momentum-design"}},R={INITIAL_SETTINGS:L,SYNC_SETTINGS:w};var _="settings",l=class{constructor(){this.initialSettings=R.INITIAL_SETTINGS;this.api=figma.clientStorage}setSettings(t){return this.api.setAsync(_,t)}getSettings(){return this.api.getAsync(_)}},O=l;var T=new O;figma.on("run",()=>m(void 0,null,function*(){(yield T.getSettings())||(yield T.setSettings(T.initialSettings))}));figma.skipInvisibleInstanceChildren=!0;figma.showUI(__html__,{themeColors:!0,height:430,width:430});figma.ui.onmessage=n=>m(void 0,null,function*(){var t,e;if(n.type===f.EXPORT){let i=yield new C(figma.root,n.settings).getAssetChunksFromPages();figma.ui.postMessage({type:"assets",data:i},{origin:"*"}),figma.ui.postMessage({type:"export"},{origin:"*"})}if(n.type===f.SET_SETTINGS&&(figma.ui.postMessage({type:"storage",data:"inprogress"},{origin:"*"}),yield T.setSettings(n.settings),figma.ui.postMessage({type:"storage",data:"complete"},{origin:"*"})),n.type===f.GET_SETTINGS){let s=yield T.getSettings();figma.ui.postMessage({type:"settings",data:s},{origin:"*"})}n.type===f.PR_CREATED&&figma.notify(`Pull Request: ${(e=(t=n.pullRequest)==null?void 0:t.data)==null?void 0:e.url}`)});})();
